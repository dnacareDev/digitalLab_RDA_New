<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 파비콘 -->
    <link rel="icon" href="/favicon.ico">
    <!-- <link rel="icon" href="../../static/favicon.ico"> -->
    <title>Digital Lab - 사용자 관리</title>
    <link type="text/css" rel="stylesheet" href="/css/common/reset.css">
    <link type="text/css" rel="stylesheet" href="/css/common/common.css">
    <link type="text/css" rel="stylesheet" href="/css/common/ui.css">
    <link type="text/css" rel="stylesheet" href="/css/style/user_management2_user.css">
    
    <script src="/js/common/jquery-3.6.0.js"></script>
    <script src="/js/common/loadHeader.js"></script>
    <script src="/js/common/common.js"></script>

    <!-- <link type="text/css" rel="stylesheet" href="../../static/css/common/reset.css">
    <link type="text/css" rel="stylesheet" href="../../static/css/common/common.css">
    <link type="text/css" rel="stylesheet" href="../../static/css/common/ui.css">
    <link type="text/css" rel="stylesheet" href="../../static/css/style/user_management2_user.css">
    
    <script src="../../static/js/common/jquery-3.6.0.js"></script>
    <script src="../../static/js/common/loadHeader.js"></script>
    <script src="../../static/js/common/common.js"></script> -->
</head>
<body>
    <div id="wrap">
        <!-- 공통 구조 - header -->
        <div id="header">
			<th:block th:include="/../header/header.html"></th:block>
		</div>
        <!-- 공통 구조 - header end -->
        
        <!-- 공통 구조 - main -->
        <main id="main">
            <!-- 공통 구조 - main_header -->
            <th:block th:include="/../header/main_header.html"></th:block>
            <!-- 공통 구조 - main_header end-->
            
            <!-- 공통 구조 - quick menu -->
            <th:block th:include="/../header/quick_menu.html"></th:block>
            <!-- 공통 구조 - quick menu end -->
                   
            <section class="card_box new_user_sect">
                <div class="card_title_box">
                    <h2 class="card_title">사용자 관리</h2>
                    <ul class="card_list_text">
                        <li class="card_inner_list">사용자 관리 - </li>
                        <li class="card_inner_list">사용자 정보</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card_cont_box">
                       <form action="" class="new_user_form common_form">
                            <div class="user_data_box">
                                <div class="top_form_box user_form_box">
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">사용자 ID</label>
                                        <input type="text" id="" th:value="${user.account}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">성명</label>
                                        <input type="text" id="" th:value="${user.name}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">소속 그룹 명</label>
                                        <input type="text" id="" th:value="${user.groupName}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">이메일</label>
                                        <input type="text" id="" th:value="${user.email}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">디지털 식별 코드</label>
                                        <input type="text" id="" th:value="${user.digitalCode == null ? '-' : user.digitalCode}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">소속 그룹 코드</label>
                                        <input type="text" id="" th:value="${user.groupCode == null ? '-' : user.groupCode}" disabled>
                                    </div>
                                </div>
                                <div class="middle_form_box user_form_box">
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">직책</label>
                                        <input type="text" id="" th:value="${user.title == null ? '-' : user.title}" disabled>
                                    </div>
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">직급(종)</label>
                                        <input type="text" id="" th:value="${user.position == null ? '-' : user.position}" disabled>
                                    </div>
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">최근 수정 일자
                                        </label>
                                        <input type="text" id="" th:value="${user.updateDat}" disabled>
                                    </div>
                                   
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">직책코드</label>
                                        <input type="text" id="" th:value="${user.titleCode == null ? '-' : user.position}" disabled>
                                    </div>
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">직급(종) 코드
                                        </label>
                                        <input type="text" id="" th:value="${user.positionCode == null ? '-' : user.positionCode}" disabled>
                                    </div>
                                    <div class="form_box user_info_box select_box">
                                        <label for="" class="file_title">계정 생성 일자
                                        </label>
                                        <input type="text" id="" th:value="${user.createDat}" disabled>
                                    </div>
                                </div>
                                <div class="bpttom_form_box user_form_box">
                                    <!-- < div class="form_box user_info_box">
                                        <label for="" class="file_title">전화번호</label>
                                        <input type="tel" id="" th:value="${user.mobilePhone == null ? '-' : user.mobilePhone}" disabled>
                                    </div> -->
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">휴대전화 번호</label>
                                        <input type="tel" id="" th:value="${user.mobilePhone == null ? '-' : user.mobilePhone}" disabled>
                                    </div>
                                    <div class="form_box user_info_box">
                                        <label for="" class="file_title">구분</label>
                                        <input type="text" id="" th:value="${user.userType}" disabled>
                                    </div>
                                    <div class="form_box select_box user_info_box">
                                        <label for="" class="file_title">권한</label>
                                        <select name="" id="authority" class=" common_select" 
                                        	th:disabled="${(user.authority == 'ADMIN' || session.LOGIN_MEMBER.authority == 'RESPONSIBLE' || session.LOGIN_MEMBER.authority == 'RESEARCHER')
                                        				? true : (user.authority == 'MANAGER' 
                                        				? (session.LOGIN_MEMBER.authority == 'ADMIN' 
                                        				? false : true) : false )}">
                                            <option value="-1" hidden>권한 선택</option>
	                                        <option value="ADMIN" th:selected="${user.authority} == 'ADMIN'" th:if="${user.authority == 'ADMIN'}">어드민</option>
                                            <option value="MANAGER" th:selected="${user.authority} == 'MANAGER'" th:if="${user.authority == 'MANAGER' || session.LOGIN_MEMBER.authority == 'ADMIN'}">관리자</option>
                                            <option value="RESPONSIBLE" th:selected="${user.authority} == 'RESPONSIBLE'">책임자</option>
                                            <option value="RESEARCHER" th:selected="${user.authority} == 'RESEARCHER'">연구자</option>
                                        </select>
                                    </div> 
                                    <!-- <div class="form_box user_info_box">
                                        <label for="" class="file_title">설명</label>
                                        <textarea name="" id="" class="" disabled>text</textarea>
                                    </div>  -->
                                </div>
                            </div>
                       </form>
                    </div>
                </div>
                <div class="card_footer">
                    <a href="/user/user_list" class="list_btn common_btn1" style="display: flex; justify-content: center; align-items: center;">목록</a>
                    <div class="footer_btn_wrap">
                        <button type="button" class="appl_regist_btn common_btn1">수정</button>
                    </div>
                    
                </div>
            </section>
        </main>
        <!-- 공통 구조 - main end -->
    </div>
	
	<script type="text/javascript" th:inline="javascript">
		let user = [[${user}]];
	</script>
	<script>
		
		$('.appl_regist_btn').on('click' , function(){
			
			let authority = $('#authority').val();
			
			$.ajax({
				url : `/api/user/modify`,
				type : 'POST',
				contentType: 'application/json; charset=utf-8',
				data : JSON.stringify({
					"account" : user.account,
					"authority" : authority,
					"groupCode" : user.groupCode
				}),
				success: function(data){
					
					if(data == 1){
						alert("권한을 변경하였습니다")
						location.reload();
					}else if (data == 0){
						alert("수정 권한이 없습니다")
					}
				}
			})
		})
	</script>
</body>
</html>